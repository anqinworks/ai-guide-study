<!-- pages/goal-setting/goal-setting.wxml -->
<view class="container">
  <!-- é¡µé¢æ ‡é¢˜ -->
  <view class="page-header">
    <text class="page-title">å­¦ä¹ ç›®æ ‡è®¾ç½®</text>
    <text class="page-subtitle">è®¾ç½®ä½ çš„å­¦ä¹ ç›®æ ‡ï¼Œè¿½è¸ªå­¦ä¹ è¿›åº¦</text>
  </view>
  
  <!-- ç°æœ‰ç›®æ ‡åˆ—è¡¨ -->
  <view class="goals-section" wx:if="{{goals.length > 0}}">
    <view class="section-header">
      <text class="section-title">æˆ‘çš„å­¦ä¹ ç›®æ ‡</text>
      <text class="section-count">å…±{{goals.length}}ä¸ª</text>
    </view>
    
    <view class="goals-list">
      <view class="goal-item" wx:for="{{goals}}" wx:key="id">
        <view class="goal-main" bindtap="editGoal" data-goal="{{item}}">
          <view class="goal-header-row">
            <view class="goal-priority-badge priority-{{item.priority}}">
              <text class="priority-text">P{{item.priority}}</text>
            </view>
            <text class="goal-name">{{item.name}}</text>
            <view class="goal-status-badge status-{{item.status}}">
              <text class="status-text">{{item.status === 'active' ? 'è¿›è¡Œä¸­' : item.status === 'completed' ? 'å·²å®Œæˆ' : 'å·²æš‚åœ'}}</text>
            </view>
          </view>
          
          <text class="goal-description" wx:if="{{item.description}}">{{item.description}}</text>
          
          <view class="goal-progress-section">
            <view class="progress-info">
              <text class="progress-label">å®Œæˆè¿›åº¦</text>
              <text class="progress-value">{{item.progress}}%</text>
            </view>
            <view class="progress-bar-wrapper">
              <view class="progress-bar" style="width: {{item.progress}}%"></view>
            </view>
          </view>
          
          <view class="goal-meta">
            <text class="goal-date" wx:if="{{item.targetDate}}">ç›®æ ‡æ—¥æœŸï¼š{{item.targetDate}}</text>
            <text class="goal-actions" catchtap="deleteGoal" data-id="{{item.id}}" data-name="{{item.name}}">åˆ é™¤</text>
          </view>
        </view>
      </view>
    </view>
  </view>
  
  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:if="{{goals.length === 0 && !showForm}}">
    <view class="empty-icon">ğŸ¯</view>
    <text class="empty-text">è¿˜æ²¡æœ‰è®¾ç½®å­¦ä¹ ç›®æ ‡</text>
    <text class="empty-hint">ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®å¼€å§‹è®¾ç½®ä½ çš„ç¬¬ä¸€ä¸ªå­¦ä¹ ç›®æ ‡</text>
  </view>
  
  <!-- æ·»åŠ /ç¼–è¾‘ç›®æ ‡è¡¨å• -->
  <view class="form-section" wx:if="{{showForm}}">
    <view class="form-card">
      <view class="form-header">
        <text class="form-title">{{editingGoal ? 'ç¼–è¾‘å­¦ä¹ ç›®æ ‡' : 'æ–°å»ºå­¦ä¹ ç›®æ ‡'}}</text>
        <text class="form-close" bindtap="cancelEdit">âœ•</text>
      </view>
      
      <view class="form-content">
        <!-- ç›®æ ‡åç§° -->
        <view class="form-item">
          <view class="form-label-wrapper">
            <view class="form-label-icon">ğŸ“</view>
            <text class="form-label required">ç›®æ ‡åç§°</text>
          </view>
          <view class="form-input-wrapper">
            <input 
              class="form-input-enhanced" 
              placeholder="ä¾‹å¦‚ï¼šæŒæ¡JavaScriptåŸºç¡€è¯­æ³•"
              value="{{formData.name}}"
              bindinput="onNameInput"
              bindfocus="onNameFocus"
              bindblur="onNameBlur"
              maxlength="200"
            />
            <view class="input-char-count">
              <text class="char-count-text">{{formData.name.length || 0}}/200</text>
            </view>
          </view>
          <text class="form-hint">å¿…å¡«ï¼Œä¸è¶…è¿‡200ä¸ªå­—ç¬¦</text>
        </view>
        
        <!-- ç›®æ ‡æè¿° -->
        <view class="form-item">
          <view class="form-label-wrapper">
            <view class="form-label-icon">ğŸ“„</view>
            <text class="form-label">ç›®æ ‡æè¿°</text>
          </view>
          <textarea 
            class="form-textarea" 
            placeholder="è¯¦ç»†æè¿°ä½ çš„å­¦ä¹ ç›®æ ‡ï¼Œä¾‹å¦‚ï¼šå®ŒæˆJavaScriptåŸºç¡€è¯­æ³•å­¦ä¹ ï¼ŒåŒ…æ‹¬å˜é‡ã€å‡½æ•°ã€å¯¹è±¡ç­‰æ ¸å¿ƒæ¦‚å¿µ"
            value="{{formData.description}}"
            bindinput="onDescriptionInput"
            maxlength="500"
            auto-height
          />
          <text class="form-hint">é€‰å¡«ï¼Œä¸è¶…è¿‡500ä¸ªå­—ç¬¦</text>
        </view>
        
        <!-- ç›®æ ‡æ—¥æœŸ -->
        <view class="form-item">
          <view class="form-label-wrapper">
            <view class="form-label-icon">ğŸ“…</view>
            <text class="form-label">ç›®æ ‡å®Œæˆæ—¥æœŸ</text>
          </view>
          <picker 
            mode="date" 
            value="{{formData.targetDate}}"
            start="{{minDate}}"
            bindchange="onDateChange">
            <view class="picker-view">
              <text class="picker-text">{{formData.targetDate || 'é€‰æ‹©ç›®æ ‡å®Œæˆæ—¥æœŸï¼ˆé€‰å¡«ï¼‰'}}</text>
              <text class="picker-arrow">></text>
            </view>
          </picker>
        </view>
        
        <!-- ä¼˜å…ˆçº§ -->
        <view class="form-item">
          <view class="form-label-wrapper">
            <view class="form-label-icon">â­</view>
            <text class="form-label">ä¼˜å…ˆçº§</text>
          </view>
          <view class="priority-options">
            <view 
              class="priority-option {{formData.priority === item ? 'selected' : ''}}"
              wx:for="{{[1,2,3,4,5]}}" 
              wx:key="*this"
              wx:for-item="item"
              bindtap="selectPriority"
              data-priority="{{item}}">
              <text class="priority-number">{{item}}</text>
              <text class="priority-label">{{item === 5 ? 'æœ€é«˜' : item === 1 ? 'æœ€ä½' : ''}}</text>
            </view>
          </view>
          <text class="form-hint">1-5ï¼Œæ•°å­—è¶Šå¤§ä¼˜å…ˆçº§è¶Šé«˜</text>
        </view>
        
        <!-- å½“å‰è¿›åº¦ï¼ˆä»…ç¼–è¾‘æ—¶æ˜¾ç¤ºï¼‰ -->
        <view class="form-item progress-form-item" wx:if="{{editingGoal}}">
          <view class="form-label-wrapper">
            <view class="form-label-icon">ğŸ“Š</view>
            <text class="form-label">å½“å‰è¿›åº¦</text>
          </view>
          
          <!-- è¿›åº¦å¯è§†åŒ–å¡ç‰‡ -->
          <view class="progress-visual-card">
            <view class="progress-header">
              <text class="progress-label-text">å®Œæˆè¿›åº¦</text>
              <view class="progress-percentage-badge">
                <text class="progress-percentage-value">{{formData.progress}}</text>
                <text class="progress-percentage-unit">%</text>
              </view>
            </view>
            
            <!-- å¯è§†åŒ–è¿›åº¦æ¡ï¼ˆå¯æ‹–åŠ¨ï¼‰ -->
            <view class="progress-bar-container">
              <view class="progress-bar-track" 
                    bindtouchstart="onProgressTouchStart" 
                    bindtouchmove="onProgressTouchMove" 
                    bindtouchend="onProgressTouchEnd"
                    catchtouchstart="onProgressTouchStart"
                    catchtouchmove="onProgressTouchMove"
                    catchtouchend="onProgressTouchEnd">
                <view class="progress-bar-fill" style="width: {{formData.progress}}%">
                  <view class="progress-bar-glow"></view>
                </view>
                <!-- æ‹–åŠ¨æŒ‡ç¤ºå™¨ - æ”¾åœ¨trackå±‚çº§ä»¥ä¾¿æ­£ç¡®å®šä½ -->
                <view class="progress-drag-handle" style="left: {{formData.progress}}%">
                  <view class="drag-handle-circle"></view>
                  <view class="drag-handle-pulse"></view>
                </view>
                <view class="progress-milestones">
                  <view class="milestone milestone-0 {{formData.progress >= 0 ? 'reached' : ''}}"></view>
                  <view class="milestone milestone-25 {{formData.progress >= 25 ? 'reached' : ''}}"></view>
                  <view class="milestone milestone-50 {{formData.progress >= 50 ? 'reached' : ''}}"></view>
                  <view class="milestone milestone-75 {{formData.progress >= 75 ? 'reached' : ''}}"></view>
                  <view class="milestone milestone-100 {{formData.progress >= 100 ? 'reached' : ''}}"></view>
                </view>
                <!-- æ‹–åŠ¨æç¤º -->
                <view class="progress-drag-hint {{isDraggingProgress ? 'active' : ''}}">
                  <text class="drag-hint-text">æ‹–åŠ¨è°ƒæ•´è¿›åº¦</text>
                </view>
              </view>
            </view>
            
            <!-- è¿›åº¦çŠ¶æ€æç¤º -->
            <view class="progress-status-hint">
              <text class="status-hint-text">{{formData.progress === 0 ? 'åˆšåˆšå¼€å§‹' : formData.progress < 25 ? 'èµ·æ­¥é˜¶æ®µ' : formData.progress < 50 ? 'ç¨³æ­¥å‰è¿›' : formData.progress < 75 ? 'è¿›å±•è‰¯å¥½' : formData.progress < 100 ? 'æ¥è¿‘å®Œæˆ' : 'å·²å®Œæˆ'}}</text>
            </view>
          </view>
        </view>
        
        <!-- çŠ¶æ€ï¼ˆä»…ç¼–è¾‘æ—¶æ˜¾ç¤ºï¼‰ -->
        <view class="form-item" wx:if="{{editingGoal}}">
          <text class="form-label">çŠ¶æ€</text>
          <view class="status-options">
            <view 
              class="status-option {{formData.status === item.value ? 'selected' : ''}}"
              wx:for="{{statusOptions}}" 
              wx:key="value"
              wx:for-item="item"
              bindtap="selectStatus"
              data-status="{{item.value}}">
              <text class="status-icon">{{item.icon}}</text>
              <text class="status-text">{{item.label}}</text>
            </view>
          </view>
        </view>
      </view>
      
      <!-- è¡¨å•æŒ‰é’® -->
      <view class="form-actions">
        <button class="btn btn-cancel" bindtap="cancelEdit">å–æ¶ˆ</button>
        <button class="btn btn-submit" bindtap="saveGoal" disabled="{{saving}}">
          {{saving ? 'ä¿å­˜ä¸­...' : 'ä¿å­˜'}}
        </button>
      </view>
    </view>
  </view>
  
  <!-- æ·»åŠ æŒ‰é’® -->
  <view class="add-button-wrapper" wx:if="{{!showForm}}">
    <button class="btn-add" bindtap="showAddForm">
      <text class="btn-add-icon">+</text>
      <text class="btn-add-text">æ·»åŠ å­¦ä¹ ç›®æ ‡</text>
    </button>
  </view>
</view>

