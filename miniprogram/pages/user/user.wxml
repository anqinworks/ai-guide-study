<!-- pages/user/user.wxml -->
<view class="container">
  <!-- ç™»å½•è¡¨å• -->
  <view class="login-section" wx:if="{{!isLoggedIn}}">
    <text class="login-title">ç™»å½•</text>
    
    <!-- å¾®ä¿¡æˆæƒç™»å½•æŒ‰é’® -->
    <button class="wx-login-btn" bindtap="wxLogin" disabled="{{loginBtnDisabled}}">
      <text class="wx-login-icon">ğŸ“±</text>
      <text class="wx-login-text">{{loginBtnDisabled ? 'ç™»å½•ä¸­...' : 'å¾®ä¿¡æˆæƒç™»å½•'}}</text>
    </button>
  </view>
  
  <!-- ç”¨æˆ·ä¿¡æ¯ -->
  <view class="user-info-section" wx:if="{{isLoggedIn}}">
    <image src="{{userInfo.avatar}}" class="avatar" mode="aspectFill" lazy-load="true"></image>
    <text class="nickname">{{userInfo.nickname || 'ç”¨æˆ·'}}</text>
    <text class="user-id">ID: {{userInfo.id || ''}}</text>
  </view>
  
  <!-- å­¦ä¹ ç»Ÿè®¡å¡ç‰‡ -->
  <view class="learning-stats-section" wx:if="{{isLoggedIn}}">
    <view class="learning-stats-card">
      <view class="stats-header">
        <text class="stats-title">ğŸ“Š å­¦ä¹ ç»Ÿè®¡</text>
        <text class="stats-subtitle">ä»Šæ—¥å­¦ä¹ æ—¶é•¿</text>
      </view>
      
      <view class="stats-content">
        <view class="time-display">
          <text class="time-value">{{learningStats.todayMinutes || 0}}</text>
          <text class="time-unit">åˆ†é’Ÿ</text>
        </view>
        
        <view class="stats-grid">
          <view class="stat-item">
            <text class="stat-icon">ğŸ“š</text>
            <text class="stat-value">{{learningStats.totalMinutes || 0}}</text>
            <text class="stat-label">æ€»å­¦ä¹ æ—¶é•¿</text>
          </view>
          <view class="stat-item">
            <text class="stat-icon">ğŸ¯</text>
            <text class="stat-value">{{learningStats.targetMinutes || 30}}</text>
            <text class="stat-label">æ¯æ—¥ç›®æ ‡</text>
          </view>
          <view class="stat-item">
            <text class="stat-icon">ğŸ”¥</text>
            <text class="stat-value">{{learningStats.continuousDays || 0}}</text>
            <text class="stat-label">è¿ç»­å­¦ä¹ </text>
          </view>
        </view>
        
        <view class="progress-section">
          <view class="progress-info">
            <text class="progress-label">ä»Šæ—¥è¿›åº¦</text>
            <text class="progress-text">{{learningStats.progress || 0}}%</text>
          </view>
          <view class="progress-bar-wrapper">
            <view class="progress-bar" style="width: {{learningStats.progress || 0}}%"></view>
          </view>
        </view>
      </view>
    </view>
    
    <!-- å­¦ä¹ ç›®æ ‡å¡ç‰‡ -->
    <view class="learning-goal-card">
      <view class="goal-header">
        <text class="goal-title">ğŸ¯ å­¦ä¹ ç›®æ ‡</text>
        <text class="goal-edit-btn" bindtap="editGoal">è®¾ç½®</text>
      </view>
      
      <view class="goal-content">
        <view class="goal-item" wx:for="{{learningGoals}}" wx:key="id">
          <view class="goal-info">
            <text class="goal-name">{{item.name}}</text>
            <text class="goal-desc" wx:if="{{item.description}}">{{item.description}}</text>
          </view>
          <view class="goal-progress">
            <view class="goal-progress-bar">
              <view class="goal-progress-fill" style="width: {{item.progress}}%"></view>
            </view>
            <text class="goal-progress-text">{{item.progress}}%</text>
          </view>
        </view>
        
        <view class="no-goal" wx:if="{{learningGoals.length === 0}}">
          <text class="no-goal-text">è¿˜æ²¡æœ‰è®¾ç½®å­¦ä¹ ç›®æ ‡</text>
          <button class="set-goal-btn" bindtap="editGoal">è®¾ç½®å­¦ä¹ ç›®æ ‡</button>
        </view>
      </view>
    </view>
  </view>
  
  <!-- åŠŸèƒ½èœå• -->
  <view class="menu-section" wx:if="{{isLoggedIn}}">
    <view class="menu-item" bindtap="logout">
      <text class="menu-icon">ğŸšª</text>
      <text class="menu-text">é€€å‡ºç™»å½•</text>
      <text class="menu-arrow">></text>
    </view>
  </view>
</view>